name: Update Project Field on Issue/PR Closed

on:
  workflow_call:
    inputs:
      project_name:
        description: 'Name of the Project which tracks completed sprints'
        type: 'string'
        required: true
      field_name:
        description: 'Name of the Field in the project to update'
        type: 'string'
        required: false
        default: 'CompletedSprint'

jobs:
  update_completed_sprint:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 16
      - run: pwd
      - name: npm ci
        id: npm_ci
        run: "cd ${{ github.workspace }}/update-completed-sprint-on-issue-closed && npm ci"
      - name: Update the completed sprint
        id: update_completed_sprint
        uses: actions/github-script@v5
        with:
          script: |
            const script = require('${{ github.workspace }}/update-completed-sprint-on-issue-closed/dist/index.js');
            await script();
